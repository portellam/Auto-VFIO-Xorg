#!/bin/bash sh

#
# Filename:         deploy-vfio
# Description:      Effortlessly deploy a VFIO setup (PCI passthrough).
# Author(s):        Alex Portell <github.com/portellam>
# Maintainer(s):    Alex Portell <github.com/portellam>
#

# <remarks> Using </remarks>
# <code>
    source vfiolib-all
# </code>

# <code>
function Main
{
    IsSudoUser || return 1

    # <remarks> Gather arguments. </remarks>
    if ! SetOptions $@; then
        GetUsage
        return "$?"
    fi

    if ExecuteBackups; then
        _HAS_EXECUTED_BACKUPS=true
    fi

    # <remarks> Exit early. </remarks>
    if "$_EXECUTE_UNINSTALL_SETUP"; then
        ExecuteSetup
        return "$?"
    fi

    ExecuteEssentials || return 1
    # ExecuteExtras || return 1

    # <remarks> Main setup </remarks>
    # case true in
    #     "$_PARSE_IOMMU_FROM_CACHE" | * )
    #         ExecuteParse "SYSTEM" || return 1 ;;

    #     "$_PARSE_IOMMU_FROM_FILE" )
    #         ExecuteParse "FILE" || return 1 ;;

    #     "$_PARSE_IOMMU_FROM_INTERNET" )
    #         ExecuteParse "ONLINE" || return 1 ;;
    # esac

    ExecuteParse || return 1
    ExecuteSetup || return 1
    return 0
}
# </code>

Main "$@"
exit "$?"