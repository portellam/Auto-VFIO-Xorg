#!/bin/false

#
# Filename:       vfiolib-pre-args
# Description:    Argument logic for pre setup.
# Author(s):      Alex Portell <github.com/portellam>
# Maintainer(s):  Alex Portell <github.com/portellam>
#

# <sources>
  source vfiolib-pre-setup
# </sources>

# <functions>
  function IsArgumentOfPreSetup
  {
    IsArgumentSkipPreSetup "$@" || return 1
    IsArgumentUninstallPreSetup "$@" || return 1
    IsArgumentSetupIsolcpu "$@" || return 1
    IsArgumentSetupHugepages "$@" || return 1
    IsArgumentSetupVirtualKVM "$@" || return 1
  }

  function IsArgumentSetupHugepages
  {
    if [[ "${1}" == "-h" ]] \
      || [[ "${1}" == "--hugepages" ]]; then
      shift
      GetArgumentsForHugepages "${1}" "${2}" || return 1
      IsHostMemorySufficientForHugepages || return 1
      ShiftInputIfOptionHasArgument "${1}" "${2}"
      PRE_SETUP_ASK_TO_EXECUTE_ALL=false
      PRE_SETUP_DO_EXECUTE_HUGEPAGES=true
      return 0
    fi

    return 1
  }

  function GetArgumentsForHugepages
  {
    if [[ ! -z "${1}" ]] \
      && ! GetHugepageByteSize "${1}"; then
      PrintStatementInvalidArgument "${1}"
      return 1
    fi

    if [[ ! -z "${2}" ]] \
      && ! GetHugepageCount "${2}"; then
      PrintStatementInvalidArgument "${2}"
      return 1
    fi
  }

  function IsArgumentSetupIsolcpu
  {
    if [[ "${1}" == "-c" ]] \
      || [[ "${1}" == "--cpu" ]]; then
      PRE_SETUP_ASK_TO_EXECUTE_ALL=false
      PRE_SETUP_DO_EXECUTE_ISOLCPU=true
      return 0
    fi

    return 1
  }

  function IsArgumentSetupVirtualKVM
  {
    if [[ "${1}" == "-e" ]] \
      || [[ "${1}" == "--evdev" ]]; then
      PRE_SETUP_ASK_TO_EXECUTE_ALL=false
      PRE_SETUP_DO_EXECUTE_EVDEV=true
      return 0
    fi

    return 1
  }

  function IsArgumentSkipPreSetup
  {
    if [[ "${1}" == "--skip-pre-setup" ]]; then
      PRE_SETUP_DO_SKIP_ALL=true
      PRE_SETUP_ASK_TO_EXECUTE_ALL=false
      return 0
    fi

    return 1
  }

  function IsArgumentUninstallPreSetup
  {
    if [[ "${1}" == "--uninstall-pre-setup" ]]; then
      PRE_SETUP_ASK_TO_EXECUTE_ALL=false
      return 0
    fi

    return 1
  }
# </functions>