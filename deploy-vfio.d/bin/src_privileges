#!/bin/false

#
# Filename:       src_privileges
# Description:    User privilege authentication.
# Author(s):      Alex Portell <github.com/portellam>
# Maintainer(s):  Alex Portell <github.com/portellam>
#

#
# sources
#
  declare -g SRC_STR_SCRIPT_DIR="/usr/local/bin/"
  declare -g SRC_STR_SCRIPT_BIN_DIR="${SRC_STR_SCRIPT_DIR}deploy-vfio.d/"

  source "${SRC_STR_SCRIPT_BIN_DIR}src_print"

#
# logic
#
  #
  # DESC:   Is user superuser.
  # RETURN: If user is root, return 0.
  #         If false, return 1.
  #
    function src_privileges_is_user_superuser
    {
      if [[ $( whoami ) != "root" ]]; then
        print_and_log_warn "User is not sudo or root."
        print_and_log_warn "Logger may not work."
        return 1
      fi

      log_output "User is sudo or root."
      return 0
    }

  #
  # DESC:   Add user to required groups.
  # RETURN: If user is added to groups, return 0.
  #         If false, return 1.
  #
    function src_privileges_add_user_to_required_groups
    {
      if ! sudo adduser "${USER}" "libvirt" &> /dev/null \
        ||  ! sudo adduser "${USER}" "input" &> /dev/null; then
        print_and_log_fail "Could not add user to required groups."
        return 1
      fi

      print_pass_to_log "Added user to required groups."
    }