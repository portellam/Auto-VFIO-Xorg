#!/bin/false

#
# Filename:       src_post_setup
# Description:    Post setup logic.
# Author(s):      Alex Portell <github.com/portellam>
# Maintainer(s):  Alex Portell <github.com/portellam>
#

#
# TODO:
# - [ ] develop.
# - [ ] test.
#

#
# sources
#
  declare -g SRC_STR_SCRIPT_DIR="/usr/local/bin/"
  declare -g SRC_STR_SCRIPT_BIN_DIR="${SRC_STR_SCRIPT_DIR}deploy-vfio.d/"

  source "${SRC_STR_SCRIPT_BIN_DIR}src_print"
  source "${SRC_STR_SCRIPT_BIN_DIR}src_auto_xorg"
  source "${SRC_STR_SCRIPT_BIN_DIR}src_libvirt_hooks"
  source "${SRC_STR_SCRIPT_BIN_DIR}src_looking_glass"
  source "${SRC_STR_SCRIPT_BIN_DIR}src_zram_swap"

#
# setter logic
#
  #
  # DESC: globals
  #
    function set_globals
    {
      log_stdout "${0}: ${FUNCNAME}"

      if [[ "${SRC_POST_SETUP_BOOL_SET_GLOBALS}" == true ]]; then
        return 0
      fi

      declare -g SRC_POST_SETUP_BOOL_SET_GLOBALS=true

      declare -g SRC_POST_SETUP_BOOL_DO_INSTALL_AUDIO_LOOPBACK=false
      declare -g SRC_POST_SETUP_BOOL_DO_INSTALL_AUTO_XORG=true
      declare -g SRC_POST_SETUP_BOOL_DO_INSTALL_LIBVIRT_HOOKS=true
      declare -g SRC_POST_SETUP_BOOL_DO_INSTALL_LOOKING_GLASS=true
      declare -g SRC_POST_SETUP_BOOL_DO_INSTALL_SCREAM=false
      declare -g SRC_POST_SETUP_BOOL_DO_INSTALL_ZRAM_SWAP=true

      declare -g SRC_POST_SETUP_STR_AUTO_XORG_ARGUMENTS=""
    }

#
# Logic
#
  #
  # DESC:   Is Linux distribution supported.
  # RETURN: If true, return 0. If false, return 1.
  #
  function execute_post_setup
  {
    is_git_installed
    does_git_parent_path_exist || return 1

    if "${SRC_POST_SETUP_BOOL_DO_INSTALL_AUTO_XORG}"; then
      execute_auto_xorg_installer "${SRC_POST_SETUP_STR_AUTO_XORG_ARGUMENTS}"
    else
      uninstall_auto_xorg
    fi

    if "${SRC_POST_SETUP_BOOL_DO_INSTALL_LIBVIRT_HOOKS}"; then
      install_libvirt_hooks
    else
      uninstall_libvirt_hooks
    fi

    if "${SRC_POST_SETUP_BOOL_DO_INSTALL_LOOKING_GLASS}"; then
      install_looking_glass
    # else
    #   uninstall_looking_glass
    fi

    if "${SRC_POST_SETUP_BOOL_DO_INSTALL_ZRAM_SWAP}"; then
      install_zram_swap
    # else
    #   uninstall_zram_swap
    fi

    return 0
  }

#
# main logic
#
  set_globals
  unset set_globals

#
# notes:
#
#
# - [ ] add repos
#   - [ ] "Audio Loopback"  "github.com/portellam/audio-loopback"
#   - [ ] "Scream"          "github.com/duncanthrax/scream"
#